# MapReduce

## MapReduce

맵리듀스는 데이터 처리를 위한 프로그래밍 모델이다.

하둡은 자바, 루비, 파이썬 등 다양한 언어로 맵리듀스를 만들고, 실행할 수 있다.

맵 리듀스는 처음부터 병행성을 위해 설계되었기 때문에 누구나 쉽게(?) 빅 데이터 분석을 할 수 있다.

<br>

## Weather Data Set

간단한 예제로 기상 데이터 셋을 활용하여 연도에 따른 기온 데이터를 입력받아, 연도별 최고 기온을 찾는 예제를 진행해보자.

하나의 gzip 파일에는 연도에 따른 기상관측소가 측정한 정보들이 들어있다.

gzip의 각 행에는 기상관측소 식별자를 시작으로, 관측 날짜, 관측 시간, 바람 방향, 구름 고도 등의 다양한 정보가 (구분자 없이) 나열되어 있다.

<br>

## Analyzing the Data with Unix Tools

하둡과의 비교를 위해 처음에는 awk로 데이터를 분석해보자.

awk는 행 기반의 데이터 처리를 위한 유닉스 툴이다.

책에 따르면, 20세기 전체 데이터를 한 대의 EC2 인스턴스에서 처리하는데 42분이 걸렸다고 한다.

<br>

프로세스를 병렬로 수행한다면 처리 속도가 빨라질 것이다.

한 대의 머신이라도 병렬로 처리한다면 속도가 빨라질 수 있지만, 다음과 같은 문제가 발생한다.

1. 일을 똑같은 크기로 나누는 것은 쉽지 않다

   - 연도별로 데이터를 나눈다면, 데이터가 가장 큰 연도를 맡은 프로세스에 의해 전체 시간이 결정된다

     - 대안으로 전체 데이터를 똑같은 크기로 나눠 실행하는 방법이 있다

<br>

2. 병렬로 처리한 결과를 다시 합치는 데 더 많은 처리가 필요할 수도 있다

   - 앞에 말한 것처럼, 같은 연도를 나눠서 처리할 경우, 결과값을 재병합, 처리하는 과정이 필요하다

<br>

3. 아무리 병렬로 처리한다고 한들, 하나의 머신에서 처리하는 데는 한계가 있다

<br>

## Analyzing the Data with Hadoop

하둡이 제공하는 병렬 처리의 이점을 제대로 활용하기 위해서는 맵리듀스로 처리하면 된다.

<br>

### Map and Reduce

맵리듀스는 맵과 리듀스, 2단계로 구분된다.

각 단계의 입출력으로는 Key-Value(키-값)를 갖는데, 변수형은 프로그래머가 선택할 수 있다.

뿐만 아니라 프로그래머는 맵 함수와 리듀스 함수를 각각 작성해야 한다.

<br>

#### Map

이 예제에서 맵은 원본 데이터를 입력으로 받는다.

맵 입력 데이터의 Key는 데이터의 오프셋으로, 무시한다.

맵 입력 데이터의 Value는 원본 데이터다.

맵은 입력 데이터의 Value에서 연도와 기온을 추출하여 출력데이터로 출력한다.

<br>

#### MapReduce Framework

맵리듀스 프레임워크에 의해 맵의 출력값은 리듀스의 입력값으로 보내진다.

이 때, Key-Value는 Key를 기준으로 정렬되고 그룹화된다.

이 예제의 경우, 예를 들어, (1972, 213)과 (1972, 175)는 (1972, [213, 175])로 합쳐진다.

<br>

#### Reduce

리듀스는 입력값으로 연도별 기온들의 묶음을 받는다.

리듀스는 입력값을 돌면서 연도별 최고기온을 찾아 출력한다.

<br>

### JAVA MapReduce
